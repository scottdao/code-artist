<body>
    <table id="menuTreegrid"></table>
    <div id="newMenuDialog" hidden></div>
    <script>
        $('#menuTreegrid').treegrid({
            url: '/menu',
            idField: 'id',
            treeField: 'name',
            columns: [
                [{
                    field: 'id',
                    hidden: true
                }, {
                    field: 'name',
                    title: '菜单名称',
                    halign: 'center',
                    width: 180
                }, {
                    field: 'url',
                    title: '菜单链接',
                    halign: 'center',
                    width: 180,
                }, {
                    field: 'sort',
                    title: '排序',
                    align: 'center',
                    width: 100
                }]
            ]
        });
        var menuMan = {
            addMenu: () => {
                let selectedMenu = $("#menuTreegrid").treegrid('getSelected');
                if (selectedMenu == null || selectedMenu.isLeaf == 1) {
                    $.messager.alert('系统提示', '请选择一个父菜单！');
                    return;
                }
                easyuiConfig.newDialog("newMenuDialog", '新建菜单', 350, 250, "/system/newMenu.html", () => {
                    if ($("#newMenuForm").form('validate')) {
                        $.post("/menu/add", $("#newMenuForm").serialize(), data => {
                            if (data != DICT_CONSTANTS.ERROR) {
                                $.messager.alert('系统提示', '菜单' + data + '保存成功！');
                                $("#newMenuDialog").dialog('close');
                                $("#menuTreegrid").treegrid('reload');
                            } else {
                                $.messager.alert('系统提示', '菜单保存失败！');
                                $("#newMenuDialog").dialog('close');
                            }
                        });
                    }
                });
            },
            editMenu: () => {
                let selectedMenu = $("#menuTreegrid").treegrid('getSelected');
                if (selectedMenu == null) {
                    $.messager.alert('系统提示', '请选择一个菜单！');
                    return;
                }
                easyuiConfig.newDialog("newMenuDialog", '新建菜单', 350, 250, "/system/editMenu.html", () => {
                    if ($("#editMenuForm").form('validate')) {
                        $.post("/menu/edit", $("#editMenuForm").serialize(), data => {
                            if (data != DICT_CONSTANTS.ERROR) {
                                $.messager.alert('系统提示', '菜单' + data + '修改成功！');
                                $("#newMenuDialog").dialog('close');
                                $("#menuTreegrid").treegrid('reload');
                            } else {
                                $.messager.alert('系统提示', '菜单修改失败！');
                                $("#newMenuDialog").dialog('close');
                            }
                        });
                    }
                });
            },
            deleteMenu: () => {
                let selectedMenu = $("#menuTreegrid").treegrid('getSelected');
                if (selectedMenu == null) {
                    $.messager.alert('系统提示', '请选择一个要删除的菜单！');
                    return;
                } else {
                    let message = '你确定要删除这个菜单？';
                    $.messager.confirm('系统提示', selectedMenu.isLeaf == 0 ? '你确定要删除这个<span style="color:red;">父菜单</span>，删除后该菜单下所有子菜单将被删除？' : message, flag => {
                        if (flag) {
                            $.post("/menu/" + selectedMenu.id, data => {
                                if (data != DICT_CONSTANTS.ERROR) {
                                    $.messager.alert('系统提示', '删除成功！');
                                    $("#menuTreegrid").treegrid('reload');
                                } else {
                                    $.messager.alert('系统提示', '删除失败！');
                                }
                            });
                        }
                    });
                }
            }
        }
        easyuiConfig.setToolbar("menuTreegrid", {
            add: menuMan.addMenu,
            edit: menuMan.editMenu,
            delete: menuMan.deleteMenu
        });
    </script>
</body>